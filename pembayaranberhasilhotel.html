<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pembayaran - Kereta API</title>
    <style>
        body {
            background: linear-gradient(#ffecb3, #fff9e6);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .header {
            background: #ffcc00;
            padding: 22px 18px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .back-btn {
            width: 36px;
            height: 36px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 22px;
        }
        
        .header-title {
            font-weight: 700;
            font-size: 22px;
        }
        
        .container {
            max-width: 460px;
            margin: 30px auto;
            padding: 0 18px 40px;
        }
        
        .summary-box {
            background: white;
            border-radius: 14px;
            padding: 18px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .hotel-name {
            font-weight: 700;
            font-size: 18px;
        }
        
        .small-muted {
            color: #666;
            font-size: 14px;
        }
        
        .divider {
            border-top: 1px solid #eee;
            margin: 12px 0 16px;
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .payments {
            margin-top: 18px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .payment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            border-radius: 12px;
            background: #fafafa;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .payment-item.selected {
            border-color: #4caf50;
            background: #f0fff4;
        }
        
        .payment-left {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .payment-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .pay-btn {
            margin-top: 18px;
            width: 100%;
            padding: 14px;
            background: #e70011;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 18px;
            cursor: pointer;
        }
        
        .muted-small {
            font-size: 13px;
            color: #666;
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="back-btn" onclick="location.href='carihotel.html'">‚Üê</div>
        <div class="header-title">PEMBAYARAN</div>
    </div>

    <div class="container">
        <div class="summary-box">
            <div class="small-muted">Rincian Harga</div>

            <div class="summary-row" style="margin-top:12px;">
                <div class="hotel-name" id="hotelName">Nama Hotel</div>
            </div>

            <div class="divider"></div>

            <div class="summary-row">
                <div class="small-muted" id="guestInfo">Dewasa</div>
                <div style="text-align:right">
                    <div class="small-muted">x1</div>
                    <div id="linePrice" style="font-weight:700;">Rp 0</div>
                </div>
            </div>

            <div class="divider"></div>

            <div class="total-row">
                <div>Total Pembayaran</div>
                <div id="totalPrice">Rp 0</div>
            </div>

            <div class="payments">
                <div class="payment-item selected" data-method="bank" onclick="selectPayment(this)">
                    <div class="payment-left">
                        <div class="payment-icon"><img src="images/bank.png" alt="Bank" style="width:36px;height:36px;object-fit:contain;"></div>
                        <div>
                            <div style="font-weight:700;">Transfer Bank</div>
                            <div class="muted-small">Kode: 18756<br>Biaya Admin: Rp3.000</div>
                        </div>
                    </div>
                    <div class="tick" id="bankTick"><img src="images/centang.png" alt="selected" style="width:20px;height:20px;"></div>
                </div>

                <div class="payment-item" data-method="wallet" onclick="selectPayment(this)">
                    <div class="payment-left">
                        <div class="payment-icon"><img src="images/dompet.png" alt="Dompet" style="width:36px;height:36px;object-fit:contain;"></div>
                        <div>
                            <div style="font-weight:700;">Dompet</div>
                            <div class="muted-small">Top up Rp5.000</div>
                        </div>
                    </div>
                    <div class="tick" id="walletTick"></div>
                </div>
            </div>

            <button class="pay-btn" onclick="confirmPayment()">BAYAR</button>
        </div>
    </div>

    <script>
        function parseQuery() {
            const params = new URLSearchParams(window.location.search);
            return {
                hotel: params.get('hotel') || 'Nama Hotel',
                guests: params.get('guests') || '1 Dewasa, 0 Anak',
                price: params.get('price') || '0'
            };
        }

        function formatRupiah(amount) {
            const num = typeof amount === 'number' ? amount : parseInt(amount, 10) || 0;
            return 'Rp ' + num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        function selectPayment(el) {
            // remove selected class and clear ticks
            document.querySelectorAll('.payment-item').forEach(item => {
                item.classList.remove('selected');
                const t = item.querySelector('.tick');
                if (t) t.innerHTML = '';
            });

            // set selected and show tick icon
            el.classList.add('selected');
            const selTick = el.querySelector('.tick');
            if (selTick) selTick.innerHTML = '<img src="images/centang.png" alt="selected" style="width:20px;height:20px;">';

            updateTotal();
        }

        function updateTotal() {
            const selectedMethod = document.querySelector('.payment-item.selected').getAttribute('data-method');
            const base = parseInt(window._basePrice || '0', 10);
            let total = base;
            if (selectedMethod === 'bank') total += 3000; // admin
            // QRIS no admin here
            // wallet might change logic but keep base for now
            document.getElementById('totalPrice').textContent = formatRupiah(total);
        }

        function confirmPayment() {
            // Build payment result and redirect to success page
            const selectedMethod = document.querySelector('.payment-item.selected').getAttribute('data-method');
            const totalText = document.getElementById('totalPrice').textContent;

            // Generate pseudo transaction identifiers
            const txn = '190' + Math.floor(Math.random() * 1e11).toString().padStart(11, '0');
            const rrn = Math.floor(1000000 + Math.random() * 9000000).toString();
            const now = new Date();
            const time = now.toISOString();

            const params = new URLSearchParams({
                method: selectedMethod,
                amount: totalText,
                merchant: 'KAI-booking',
                txn: txn,
                rrn: rrn,
                time: time
            });

            window.location.href = 'pembayaranhotel.html?' + params.toString();
        }

        // Init
        (function() {
            const q = parseQuery();
            document.getElementById('hotelName').textContent = q.hotel;
            document.getElementById('guestInfo').textContent = q.guests;
            const price = parseInt(q.price, 10) || 0;
            window._basePrice = price;
            document.getElementById('linePrice').textContent = formatRupiah(price);
            // default total includes admin as Transfer Bank is selected initially
            updateTotal();
        })();
    </script>
</body>

</html>